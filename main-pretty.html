<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>MUPLEx</title>
	</head>

	<body>
		<script type="text/javascript">
			"use strict";

			window.onload = process;
			var _parsedFreeExp;
			
			function process() {
				var hInExp = document.getElementById('in_exp');
				var hOutParser = document.getElementById('out_parser');
				var hComputeButton = document.getElementById('but_compute');
				var hOutPretty = document.getElementById('out_pretty');
				var hOutPHTML = document.getElementById('out_phtml');
				
				var cc = new CodeColor('#A4F', '#082', '#0B4', '#248', '#A22', '#28D', '#000', '#0FF');

				var expIn = hInExp.value;
				var outParser = '';

				try {
					var t = Tokenizer.chop(expIn);
					outParser += 'Tokens:\n-------\n' + t.join(', ') + '\n\n';

					_parsedFreeExp = RDP.single(t);
					outParser += 'AST:\n----\n' + _parsedFreeExp.toString() + '\n\n';
					
					_parsedFreeExp.accept(new TypeCheck());
					outParser += 'Type checker:\n-------------\nOK.\n\n';
					
					_parsedFreeExp.accept(new VarCheck(), Emp);
					outParser += 'Var checker:\n-------------\nOK.\n\n';
					
					hComputeButton.disabled = false;
					
					var tp = Tokenizer.chop(expIn, true, true);
					var shtml = tp.reduce(function(prev, cur) { return prev + cur.toHTML(cc); },'');
					hOutPretty.innerHTML = shtml;
					hOutPHTML.value = shtml;
				} catch(err) {
					outParser += err;
					hComputeButton.disabled = true;
				}

				hOutParser.value = outParser;
			}

			function doEval() {
				var hOutInterpreter = document.getElementById('out_interpreter');
				
				var istr = '';
				try {
					Out.reset();
					var res = _parsedFreeExp.ev(Emp);
					istr += res.toString();
					
					istr += '\n---\n\n';
				 istr += Out.toString();
				} catch(err) {
					istr += 'Runtime exception: ' + err;
				}
				
				hOutInterpreter.value = istr;
			}
		</script>
		
		<script type="text/javascript" src="interpreter/List.js"></script>
		<script type="text/javascript" src="interpreter/Out.js"></script>

		<script type="text/javascript" src="interpreter/nodes/Unit.js"></script>
		<script type="text/javascript" src="interpreter/nodes/UnitQ.js"></script>

		<script type="text/javascript" src="interpreter/nodes/Num.js"></script>
		<script type="text/javascript" src="interpreter/nodes/NumQ.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Add.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Sub.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Mul.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Div.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Mod.js"></script>
		
		<script type="text/javascript" src="interpreter/nodes/Let.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Var.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Fun.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Closure.js"></script>
		<script type="text/javascript" src="interpreter/nodes/ClosureQ.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Call.js"></script>

		<script type="text/javascript" src="interpreter/nodes/Bool.js"></script>
		<script type="text/javascript" src="interpreter/nodes/BoolQ.js"></script>
		<script type="text/javascript" src="interpreter/nodes/If.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Greater.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Not.js"></script>
		<script type="text/javascript" src="interpreter/nodes/And.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Or.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Xor.js"></script>

		<script type="text/javascript" src="interpreter/nodes/Record.js"></script>
		<script type="text/javascript" src="interpreter/nodes/RecordQ.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Deref.js"></script>
		<script type="text/javascript" src="interpreter/nodes/ContainsQ.js"></script>

		<script type="text/javascript" src="interpreter/nodes/Set.js"></script>
		<script type="text/javascript" src="interpreter/nodes/SetFst.js"></script>
		<script type="text/javascript" src="interpreter/nodes/SetSnd.js"></script>

		<script type="text/javascript" src="interpreter/nodes/Pair.js"></script>
		<script type="text/javascript" src="interpreter/nodes/PairQ.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Fst.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Snd.js"></script>
		
		<script type="text/javascript" src="interpreter/nodes/Print.js"></script>
		<script type="text/javascript" src="interpreter/nodes/Def.js"></script>
		
		<script type="text/javascript" src="interpreter/Module.js"></script>
		<script type="text/javascript" src="interpreter/ModuleSet.js"></script>
  
  <script type="text/javascript" src="interpreter/types/TypeAny.js"></script>
  <script type="text/javascript" src="interpreter/types/TypeBool.js"></script>
  <script type="text/javascript" src="interpreter/types/TypeFun.js"></script>
  <script type="text/javascript" src="interpreter/types/TypeNum.js"></script>
  <script type="text/javascript" src="interpreter/types/TypePair.js"></script>
  <script type="text/javascript" src="interpreter/types/TypeRecord.js"></script>
  <script type="text/javascript" src="interpreter/types/TypeUnit.js"></script>
  
  <script type="text/javascript" src="interpreter/TypeCheck.js"></script>
  <script type="text/javascript" src="interpreter/VarCheck.js"></script>

		<script type="text/javascript" src="expansion/callStar.js"></script>
		<script type="text/javascript" src="expansion/funStar.js"></script>
		<script type="text/javascript" src="expansion/ifStar.js"></script>
		<script type="text/javascript" src="expansion/letStar.js"></script>
		<script type="text/javascript" src="expansion/letrecStar.js"></script>
		<script type="text/javascript" src="expansion/pairStar.js"></script>

		<script type="text/javascript" src="CodeColor.js"></script>

		<script type="text/javascript" src="tokenizer/IterableString.js"></script>
		<script type="text/javascript" src="tokenizer/Tokenizer.js"></script>
		<script type="text/javascript" src="tokenizer/TokBool.js"></script>
		<script type="text/javascript" src="tokenizer/TokCommML.js"></script>
		<script type="text/javascript" src="tokenizer/TokCommSL.js"></script>
		<script type="text/javascript" src="tokenizer/TokEnd.js"></script>
		<script type="text/javascript" src="tokenizer/TokIdentifier.js"></script>
		<script type="text/javascript" src="tokenizer/TokKeyword.js"></script>
		<script type="text/javascript" src="tokenizer/TokLPar.js"></script>
		<script type="text/javascript" src="tokenizer/TokNum.js"></script>
		<script type="text/javascript" src="tokenizer/TokRPar.js"></script>
		<script type="text/javascript" src="tokenizer/TokStr.js"></script>
		<script type="text/javascript" src="tokenizer/TokWhitespace.js"></script>

		<script type="text/javascript" src="parser/RDP.js"></script>
		<script type="text/javascript" src="parser/TokenList.js"></script>
		
		<h2>MUPLEx</h2>
		
		<table>
			<tr>
				<td style="vertical-align: top">
					Code:<br />
					<textarea id="in_exp" onkeyup="process()" rows="10" cols="50">(let a 10
 (let f (lambda (x) (+ x a))
  (set! a 3
   (let a 100
    (call f 11)))))</textarea>
					<br />
			
					Parser output:
					<br />
					<textarea id="out_parser" rows="10" cols="50" readonly="readonly"></textarea>		
			 	
			 	<br />
			  <input value="Compute" id="but_compute" type="button" onclick="doEval()"/>
			  <br />
			  <br />
			  Interpreter output:
					<br />
					<textarea id="out_interpreter" rows="10" cols="50" readonly="readonly"></textarea>
				</td>
				<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
				<td style="vertical-align: top">
					Pretty code:<br />
					<div id="out_pretty" style="font-family: Consolas, Courier, monospace;border: 1px solid grey; background-color: #FAFAFA;padding: 8px"></div><br />
					Pretty code HTML:<br />
					<textarea id="out_phtml" rows="10" cols="50" readonly="readonly"></textarea>
				</td>
			</tr>
		</table>
	</body>
</html>